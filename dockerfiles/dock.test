#ARG IMAGE_BASE="debian"
#ARG IMAGE_TAG="bullseye-slim"

# FROM ${IMAGE_BASE}:${IMAGE_TAG} as build


# RUN apt update && \
#     apt install -y \
#         coreutils \
#         curl \
#         git \
#         sudo \
#         bash \
#         wget \
#         xz-utils


# RUN git clone https://github.com/api7/wasm-nginx-module.git wasm && \
# cd wasm && \
# ./install-wasmtime.sh


ARG IMAGE_BASE="alpine"
ARG IMAGE_TAG="3.15"

FROM ${IMAGE_BASE}:${IMAGE_TAG} as build

RUN apk add --no-cache \
        build-base \
        coreutils \
        curl \
        gd \
        gd-dev \
        geoip \
        geoip-dev \
        libxslt \
        libxslt-dev \
        linux-headers \
        make \
        perl-dev \
        readline-dev \
        zlib \
        zlib-dev \
        unzip \
        git \
        sudo \
        bash \
        libstdc++

# install latest Rust to build wasmtime
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
